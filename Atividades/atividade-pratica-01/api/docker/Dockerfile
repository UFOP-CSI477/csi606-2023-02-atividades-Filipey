FROM elixir:1.15.7-alpine

WORKDIR /app

ARG DATABASE_HOST
ARG DATABASE_USER
ARG DATABASE_PASSWORD
ARG DATABASE_NAME
ARG API_SECRET_KEY

# APP CONFIG
ENV DATABASE_HOST ${DATABASE_HOST}
ENV DATABASE_USER ${DATABASE_USER}
ENV DATABASE_PASSWORD ${DATABASE_PASSWORD}
ENV DATABASE_NAME ${DATABASE_NAME}
ENV API_SECRET_KEY ${API_SECRET_KEY}

# BUILD CONIFG
ENV MIX_ENV="prod"


RUN mix local.hex --force, local.rebar --force

COPY . .

RUN mix do deps.get, deps.compile